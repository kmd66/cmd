@page "/cmd-admin/file-manager"
@inherits BacePage<PageObj>
@using CMS.Helper;
@using CMS.Model.Files;
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@inject ProtectedLocalStorage localStorage

<link rel="stylesheet" href="./comcss/FileManager.css" />

<PageTitle>file manager</PageTitle>


@if (isShow)
{
    base.BuildRenderTree(__builder);
    if (Obj.State == "creatFolder")
    {
        <FileManagerCreatFolder Obj="@Obj" />
    }
    else if (Obj.State == "RemoveORChengeName")
    {
        <RemoveORChengeName Obj="@Obj" />
    }
    else
    {
        <FileManagerMain Obj="@Obj" />
    }
}

@code {
    private PageObj obj = new PageObj();
    public override PageObj Obj { get => obj; set => obj = value; }
    public bool isShow = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var token = await localStorage.GetAsync<string>("token");
            Obj.Upload = new UploadHelper(token.Value);
            isShow = true;
            StateHasChanged();
        }
        await base.OnAfterRenderAsync(firstRender);
    }

}
